package barcode_test

import (
	"os"
	"testing"

	"github.com/horus-es/go-util/v2/barcode"
	"github.com/stretchr/testify/assert"
)

func TestC128A(t *testing.T) {
	bars, hri, err := barcode.GetBarcodeBARS("{A123456", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2114121232212232112211322212312132122231121132222331112", bars)
	assert.Equal(t, "123456", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{AA1Z9", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2114121113231232213123113211222321212331112", bars)
	assert.Equal(t, "A1Z9", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{AA1{2Z9", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2114121113231232214111133123113211224111132331112", bars)
	assert.Equal(t, "A1Z9", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{ADOS\nLINEAS", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2114121123131331212131131422111321312313111133211321131113232131133111412331112", bars)
	assert.Equal(t, "DOS LINEAS", hri)
	_, _, err = barcode.GetBarcodeBARS("{Aa1Z9", barcode.C128)
	assert.Error(t, err)
	_, _, err = barcode.GetBarcodeBARS("{AA1{{", barcode.C128)
	assert.Error(t, err)
}

func TestC128B(t *testing.T) {
	bars, hri, err := barcode.GetBarcodeBARS("{BA1Z9", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141113231232213123113211221113232331112", bars)
	assert.Equal(t, "A1Z9", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{Ba1z9", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241232212141213211223123112331112", bars)
	assert.Equal(t, "a1z9", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{Ba1{{}z9", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241232214121211113412141213211221222132331112", bars)
	assert.Equal(t, "a1{}z9", hri)
	_, _, err = barcode.GetBarcodeBARS("{Ba1ñz9", barcode.C128)
	assert.Error(t, err)
	_, _, err = barcode.GetBarcodeBARS("{Ba1{z9", barcode.C128)
	assert.Error(t, err)
}

func TestC128C(t *testing.T) {
	bars, hri, err := barcode.GetBarcodeBARS("{N123456", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311233311211321312331112", bars)
	assert.Equal(t, "123456", hri)
	_, _, err = barcode.GetBarcodeBARS("{N12345", barcode.C128)
	assert.Error(t, err)
	_, _, err = barcode.GetBarcodeBARS("{N12345Q", barcode.C128)
	assert.Error(t, err)
}

func TestC128(t *testing.T) {
	bars, hri, err := barcode.GetBarcodeBARS("{N123456", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311233311211321312331112", bars)
	assert.Equal(t, "123456", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{N1234{B5", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311231141312132123111232331112", bars)
	assert.Equal(t, "12345", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{N1234{B5Q", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311231141312132122113311113412331112", bars)
	assert.Equal(t, "12345Q", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{BA1Z9", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141113231232213123113211221113232331112", bars)
	assert.Equal(t, "A1Z9", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{N1234{Ba", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311231141311211243112222331112", bars)
	assert.Equal(t, "1234a", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{B123ab", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "123ab", hri)
	assert.Equal(t, "2112141232212232112211321211241214211142122331112", bars)
	bars, hri, err = barcode.GetBarcodeBARS("{Ba{N1234", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241131411122321311233112222331112", bars)
	assert.Equal(t, "a1234", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{Bab123", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241214211232212232112211321213222331112", bars)
	assert.Equal(t, "ab123", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{Ba{N123456{Bz", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241131411122321311233311211141312141211111432331112", bars)
	assert.Equal(t, "a123456z", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{Ba12345z", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241232212232112211322212312132122141213311212331112", bars)
	assert.Equal(t, "a12345z", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{B{{{N123456{B}", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112144121211131411122321311233311211141311113411123132331112", bars)
	assert.Equal(t, "{123456}", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{Bdos{S\nlineas", barcode.C128)
	assert.NoError(t, err)
	assert.Equal(t, "2112141412211341111142124113111422112211141421122411121122141211241142121122142331112", bars)
	assert.Equal(t, "dos lineas", hri)
	_, _, err = barcode.GetBarcodeBARS("{Ba12345ñ", barcode.C128)
	assert.Error(t, err)
	_, _, err = barcode.GetBarcodeBARS("{ADEU}", barcode.C128)
	assert.Error(t, err)
}

func TestC128X(t *testing.T) {
	bars, hri, err := barcode.GetBarcodeBARS("123456", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311233311211321312331112", bars)
	assert.Equal(t, "123456", hri)
	bars, hri, err = barcode.GetBarcodeBARS("12345", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311231141312132123111232331112", bars)
	assert.Equal(t, "12345", hri)
	bars, hri, err = barcode.GetBarcodeBARS("12345Q", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311231141312132122113311113412331112", bars)
	assert.Equal(t, "12345Q", hri)
	bars, hri, err = barcode.GetBarcodeBARS("A1Z9", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112141113231232213123113211221113232331112", bars)
	assert.Equal(t, "A1Z9", hri)
	bars, hri, err = barcode.GetBarcodeBARS("1234a", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112321122321311231141311211243112222331112", bars)
	assert.Equal(t, "1234a", hri)
	bars, hri, err = barcode.GetBarcodeBARS("123ab", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112141232212232112211321211241214211142122331112", bars)
	assert.Equal(t, "123ab", hri)
	bars, hri, err = barcode.GetBarcodeBARS("a1234", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241131411122321311233112222331112", bars)
	assert.Equal(t, "a1234", hri)
	bars, hri, err = barcode.GetBarcodeBARS("ab123", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241214211232212232112211321213222331112", bars)
	assert.Equal(t, "ab123", hri)
	bars, hri, err = barcode.GetBarcodeBARS("a123456z", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241131411122321311233311211141312141211111432331112", bars)
	assert.Equal(t, "a123456z", hri)
	bars, hri, err = barcode.GetBarcodeBARS("a12345z", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112141211241232212232112211322212312132122141213311212331112", bars)
	assert.Equal(t, "a12345z", hri)
	bars, hri, err = barcode.GetBarcodeBARS("{{123456}", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112144121211131411122321311233311211141311113411123132331112", bars)
	assert.Equal(t, "{123456}", hri)
	bars, hri, err = barcode.GetBarcodeBARS("dos\nlineas", barcode.C128X)
	assert.NoError(t, err)
	assert.Equal(t, "2112141412211341111142124113111422112211141421122411121122141211241142121122142331112", bars)
	assert.Equal(t, "dos lineas", hri)
	_, _, err = barcode.GetBarcodeBARS("a12345ñ", barcode.C128X)
	assert.Error(t, err)
	_, _, err = barcode.GetBarcodeBARS("{ADEU}", barcode.C128X)
	assert.Error(t, err)
}

func TestC128SVG(t *testing.T) {
	bars, err := barcode.GetBarcodeSVG("{A1234ABCD", barcode.C128, 3, 100, "#000", barcode.Both, false)
	assert.NoError(t, err)
	err = os.WriteFile("C128A.svg", []byte(bars), 0666)
	assert.NoError(t, err)
	bars, err = barcode.GetBarcodeSVG("{B1234abcd", barcode.C128, 3, 100, "#000", barcode.Above, false)
	assert.NoError(t, err)
	err = os.WriteFile("C128B.svg", []byte(bars), 0666)
	assert.NoError(t, err)
	bars, err = barcode.GetBarcodeSVG("{N12345678", barcode.C128, 3, 100, "#000", barcode.Below, false)
	assert.NoError(t, err)
	err = os.WriteFile("C128C.svg", []byte(bars), 0666)
	assert.NoError(t, err)
	bars, err = barcode.GetBarcodeSVG("1234ABCD", barcode.C128X, 3, 100, "#000", barcode.None, false)
	assert.NoError(t, err)
	err = os.WriteFile("C128.svg", []byte(bars), 0666)
	assert.NoError(t, err)
}
